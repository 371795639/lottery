<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
    <meta name="format-detection" content="telephone=no" />
    <title></title>
    <script src="js/mui.min.js"></script><script src="js/config.js"></script>
    <link href="css/mui.min.css" rel="stylesheet" />
    <link href="css/cp_upload.css" rel="stylesheet" />
    <script src="js/jquery-1.7.2.min.js"></script>
    <script type="text/javascript" src="js/common.js"></script>
</head>

<body>
    <header class="mui-bar mui-bar-nav">
    

    
        <a href='shop_order.html' class=" mui-icon mui-icon-left-nav mui-pull-left"></a>
        <h1 class="mui-title">出票上传</h1>
    </header>
    <nav class='mui-bar mui-bar-tab'>
        <button type="button" class="mui-btn mui-btn-red cp_up">出票上传</button>
    </nav>
    <div class="mui-content">
        <div class='cp_list'>
            <div class='cp_title'>选号内容</div>
            <div class='cp_content'>
                <dt><span class='c_type'></span><span class='dlt_qi'></span>期</dt>
                <dt>
                <span style="margin-right: 9px;"><span class='f_red dlt_z'></span>注<span
                        class='f_red dlt_b'></span>倍</span>
                <span class='zj'></span>
            </dt>
            </div>
            <div class='cp_money'>
                <span class='f_red dlt_m'></span>元
            </div>
            <div class='clear'></div>
        </div>
        <div class="cp_list">
            <div class='cp_title'>手机号码</div>
            <div class="cp_content dlt_phone">

            </div>
        </div>
        <div class="cp_list">
            <div class='cp_title'>取票方式</div>
            <div class="cp_content dlt_cp">

            </div>
        </div>
        <div class="cp_list">
            <div class='cp_title'>订单编号</div>
            <div class="cp_content dlt_num" id="oid">

            </div>
        </div>
        <div class="cp_list">
            <div class='cp_title'>下单时间</div>
            <div class="cp_content dlt_time">

            </div>
        </div>
        <div class="cp_list_num">
            <div class='cp_title tz_num'>投注号码</div>
            <div class='clear'></div>
            <div class='cp_numm'>
            </div>
        </div>
        <div class='cp_list_camera'>
            <div class='cp_title tz_num'>出票拍照</div>
            <div class='clear'></div>
            <div class='photo'>
                <div id="pics"></div>
                <img id='chooseImage' src="wimages/photo.png" width='50' height='50' />
            </div>

        </div>
        <input type="hidden" value='1' class='timestamp' />
        <input type="hidden" value='2' class='nonceStr' />
        <input type="hidden" value='3' class='signature' />

    </div>
</body>
<script src="http://res.wx.qq.com/open/js/jweixin-1.0.0.js"></script>
<script>
    // var oid=jQuery('.dlt_num').text();
    var oid = window.localStorage.getItem('cp_id');
    //显示照片
    mui.get(config[0].url+'/index.php/show_pic', {
        oid: oid
    }, function(data) {
        //console.log(JSON.stringify(data[0].p_name));

        if (typeof data == "string") {
            var data = eval('(' + data + ')');
        }
        console.log(data);
        // console.log(data.length);
        /*for (key in data) {
         $(".photo").append("<img src=../../Uploads/photo/"+data[key]+"/ >");
         //val = data[key];
         }*/
        if (data.length > 4) {
            $("#chooseImage").remove();
        }
        for (var i = 0; i < data.length; i++) {
            // '<img src=../../Uploads/photo/'+data.i.p_name+'>';
            $("#pics").append("<img src='"config[0].url+'/Uploads/photo/'+data[i].p_name+"' width='100%' height='400' / >");
        }

        $('.cp_up').attr('disabled', false);

    }, 'json');

    if (isWeiXin()) {


        //微信签名jdk
        var url = window.location.href;
        mui.ajax(config[0].url+'/index.php/jdk', {
            data: {
                url: url
            },
            dataType: 'json', //服务器返回json格式数据
            type: 'post', //HTTP请求类型
            timeout: 10000, //超时时间设置为10秒；
            success: function(data) {
                if (typeof data == "string") {
                    var data = eval('(' + data + ')');
                }
                //console.log(data);
                $('.timestamp').val(data.time);
                $('.nonceStr').val(data.noncestr);
                $('.signature').val(data.data);
                var time = $('.timestamp').val();
                var nonc = $('.nonceStr').val();
                var sig = $('.signature').val();

                /*
                 * 注意：
                 * 1. 所有的JS接口只能在公众号绑定的域名下调用，公众号开发者需要先登录微信公众平台进入“公众号设置”的“功能设置”里填写“JS接口安全域名”。
                 * 2. 如果发现在 Android 不能分享自定义内容，请到官网下载最新的包覆盖安装，Android 自定义分享接口需升级至 6.0.2.58 版本及以上。
                 * 3. 常见问题及完整 JS-SDK 文档地址：http://mp.weixin.qq.com/wiki/7/aaa137b55fb2e0456bf8dd9148dd613f.html
                 *
                 * 开发中遇到问题详见文档“附录5-常见错误及解决办法”解决，如仍未能解决可通过以下渠道反馈：
                 * 邮箱地址：weixin-open@qq.com
                 * 邮件主题：【微信JS-SDK反馈】具体问题
                 * 邮件内容说明：用简明的语言描述问题所在，并交代清楚遇到该问题的场景，可附上截屏图片，微信团队会尽快处理你的反馈。
                 */
                /**
                 * 微信配置文件
                 */
                wx.config({

                    debug: false,
                    appId: 'wxbc233884a5cf1afd',
                    timestamp: time,
                    nonceStr: nonc,
                    signature: sig,
                    jsApiList: [
                        'checkJsApi',
                        'onMenuShareTimeline',
                        'onMenuShareAppMessage',
                        'onMenuShareQQ',
                        'onMenuShareWeibo',
                        'onMenuShareQZone',
                        'hideMenuItems',
                        'showMenuItems',
                        'hideAllNonBaseMenuItem',
                        'showAllNonBaseMenuItem',
                        'translateVoice',
                        'startRecord',
                        'stopRecord',
                        'onVoiceRecordEnd',
                        'playVoice',
                        'onVoicePlayEnd',
                        'pauseVoice',
                        'stopVoice',
                        'uploadVoice',
                        'downloadVoice',
                        'chooseImage',
                        'previewImage',
                        'uploadImage',
                        'downloadImage',
                        'getNetworkType',
                        'openLocation',
                        'getLocation',
                        'hideOptionMenu',
                        'showOptionMenu',
                        'closeWindow',
                        'scanQRCode',
                        'chooseWXPay',
                        'openProductSpecificView',
                        'addCard',
                        'chooseCard',
                        'openCard'
                    ]
                });
            },
            error: function(xhr, type, errorThrown) {
                //异常处理；
                switch (type) {
                    case "timeout":
                        mui.toast('连接超时，请重试');
                        break;
                    default:
                        mui.toast('请重试或重新登录');
                }
            }
        });
    }
    /**
     * 判断当前环境是否为微信
     */
    function isWeiXin() {
        var ua = window.navigator.userAgent.toLowerCase();
        if (ua.match(/MicroMessenger/i) == 'micromessenger') {
            return true;
        } else {
            return false;
        }
    }
</script>
<script src="js/zepto.min.js"></script>
<!--<script src="http://203.195.235.76/jssdk/js/demo.js"></script>-->
<script type="text/javascript">
    var oid = window.localStorage.getItem('cp_id');
    /**
     * 判断当前环境是否为微信
     */
    if (isWeiXin()) {


        // 5 图片接口
        // 5.1 拍照、本地选图
        var images = {
            localId: [],
            serverId: []
        };
        document.querySelector('#chooseImage').onclick = function() {
            wx.chooseImage({
                count: 1, // 默认9
                sizeType: ['original', 'compressed'], // 可以指定是原图还是压缩图，默认二者都有
                sourceType: ['camera'], // 可以指定来源是相册还是相机，默认二者都有
                success: function(res) {
                    images.localId = res.localIds;
                    /* alert('已选择 ' + res.localIds.length + ' 张图片');*/
                    wx_upload();


                }
            });


        };


        // 5.3 上传图片
        function wx_upload() {
            var i = 0,
                length = images.localId.length;
            images.serverId = [];

            function upload() {
                wx.uploadImage({
                    localId: images.localId[i],
                    success: function(res) {
                        i++;
                        //alert('已上传：' + i + '/' + length);
                        images.serverId.push(res.serverId);
                        mids = images.serverId[0];
                        // alert(mids);
                        //		          if (i < length) {
                        //		            upload();
                        //		          }
                        /*if (i < length) {

                         }*/
                        //var oid=jQuery('.dlt_num').text();
                        var oid = window.localStorage.getItem('cp_id');
                        wxImgCallback(mids, oid);


                    },
                    fail: function(res) {
                        alert(JSON.stringify(res));
                    }
                });

            };
            upload();

        }

        //图片上传回调
        function wxImgCallback(mids, oid) {
            //var oid=jQuery('#oid').text();
            // console.log(oid);
            mui.ajax(config[0].url+'/index.php/wx_upload', {
                data: {
                    mid: mids,
                    oid: oid
                },
                dataType: 'json', //服务器返回json格式数据
                type: 'post', //HTTP请求类型
                timeout: 10000, //超时时间设置为10秒；
                success: function(data) {
                    if (typeof data == "string") {
                        var data = eval('(' + data + ')');
                    }
                    console.log(data);
                    if (data == 1) {
                        /*alert('上传成功');*/
                        mui.toast('上传成功');
                        window.location.reload(); //刷新当前页面.
                    } else {
                        /*  $("#pics").append("<img src=../../Uploads/photo/"+data+" width='100%' height='400' / >");*/
                        alert('上传失败');
                    }
                    // alert(data);

                    /*console.log(JSON.stringify(data));*/

                },


                error: function(xhr, type, errorThrown) {
                    //异常处理；
                    //console.log(type);
                    switch (type) {
                        case "timeout":
                            mui.toast('连接超时，请重试');
                            break;
                        default:
                            mui.toast('请重试或重新登录');
                    }
                }
            });
        }

    } else {

        //		document.querySelector('#chooseImage').onclick = function () {}

        $(document).on('tap', '#chooseImage', function() {

            getImage();

        });
        // H5 plus事件处理
        function plusReady() {
            // 获取摄像头目录对象
            plus.io.resolveLocalFileSystemURL("_doc/", function(entry) {
                entry.getDirectory("camera", {
                    create: true
                }, function(dir) {
                    gentry = dir;
                    //updateHistory();
                }, function(e) {
                    outSet("Get directory \"camera\" failed: " + e.message);
                });
            }, function(e) {
                outSet("Resolve \"_doc/\" failed: " + e.message);
            });
        }

        if (window.plus) {
            plusReady();
        } else {
            document.addEventListener("plusready", plusReady, false);
        }

        //拍照
        function getImage() {

            var c = plus.camera.getCamera();
            c.captureImage(function(e) {
                plus.io.resolveLocalFileSystemURL(e, function(entry) {
                    var s = entry.toLocalURL() + "?version=" + new Date().getTime();
                    uploadHead(s);
                    /*上传图片*/
                }, function(e) {
                    console.log("读取拍照文件错误：" + e.message);
                });
            }, function(s) {
                console.log("error" + s);
            }, {
                filename: "_doc/head.png"
            });
            c.close();
        }

        $(document).on('tap', '.w_info', function() {
            //mui.alert(1);
            getImage();

        });

        //上传头像图片
        function uploadHead(imgPath) {
			//mui.alert('okkkk');
            console.log("imgPath = " + imgPath);
            var mainImage = [];
            mainImage.src = imgPath;

            var image = new Image();

            image.src = imgPath;
            image.onload = function() {
				//mui.alert(21)
                var imgData = getBase64Image(image);
                                //mui.alert(imgData);return;

                //					var imgData = image;

                /*在这里调用上传接口*/
//             mui.alert(imgData);
                mui.ajax("http://test.foodietech.cn/index.php/pic_upload", {
                    data: {
                        pic: imgData,
                        oid: oid,
                    },
                    dataType: 'json',
                    type: 'post',
//                  timeout: 10000,
                    success: function(data) {
                    	//mui.alert(data);
                        if (data == 1) {
                            mui.alert('上传成功');
                            window.location.reload(); //刷新当前页面.
                        } else if (data == 2) {
                            mui.alert('上传失败');
                        }

                    },
                    error: function(xhr, type, errorThrown) {
                        mui.toast('网络异常，请稍后再试！');
                           mui.alert(type);
                    }
                });

            }
            
        }

        //将图片压缩转成base64
        function getBase64Image(img) {
            //				alert('abc');
            var canvas = document.createElement("canvas");
            var width = img.width;
            var height = img.height;
            // calculate the width and height, constraining the proportions
            if (width > height) {
                if (width > 420) {
                    /*height = Math.round(height *= 100 / width);
                     width = 414;*/
                    width = 375;
                    height = 667;
                }
            } else {
                if (height > 740) {
                    /*width = Math.round(width *= 100 / height);
                     height = 736;*/
                    width = 375;
                    height = 667;
                }
            }
            canvas.width = width;
            /*设置新的图片的宽度*/
            canvas.height = height;
            /*设置新的图片的长度*/
            var ctx = canvas.getContext("2d");
            ctx.drawImage(img, 0, 0, width, height);
            /*绘图*/
            var dataURL = canvas.toDataURL("image/jpeg", 0.8);
            
            return dataURL.replace("data:image/jpeg;base64,", "");
        }
    }

    function isWeiXin() {
        var ua = window.navigator.userAgent.toLowerCase();
        if (ua.match(/MicroMessenger/i) == 'micromessenger') {
            return true;
        } else {
            return false;
        }
    }
</script>


<script type="text/javascript">
    var order_id = window.localStorage.getItem('cp_id');
//  if (!order_id) {
//      mui.openWindow({
//          url: 'shop_order.html',
//          id: 'shop_order',
//          createNew: true
//      });
//  }
//  var cp_sta = window.localStorage.getItem('cp_sta');
//  if (cp_sta == 0) {
//      mui.openWindow({
//          url: 'shop_order.html',
//          id: 'shop_order',
//          createNew: true
//      });
//  }


    mui.ajax(config[0].url+'/index.php/cp_detail', {
        data: {
            order_id: order_id,
        },
        dataType: 'json', //服务器返回json格式数据
        type: 'post', //HTTP请求类型
        timeout: 10000, //超时时间设置为10秒；
        success: function(data) {
            if (typeof data == "string") {
                var data = eval('(' + data + ')');
            }
            //console.log(data);
            if (data.data[0].type == '01') {
                var c_type = '大乐透';
            } else if (data.data[0].type == '02') {
                var c_type = '七星彩';
            } else if (data.data[0].type == '03') {
                if (data.data[0].tz_type == 0) {
                    var c_type = '排列三·直选';
                } else if (data.data[0].tz_type == 1) {
                    var c_type = '排列三·组三';
                } else if (data.data[0].tz_type == 2) {
                    var c_type = '排列三·组六';
                } else if (data.data[0].tz_type == 3) {
                    var c_type = '排列三·直选复式胆拖';
                } else if (data.data[0].tz_type == 4) {
                    var c_type = '排列三·和值·直选';
                } else if (data.data[0].tz_type == 5) {
                    var c_type = '排列三·和值·组三';
                } else if (data.data[0].tz_type == 6) {
                    var c_type = '排列三·和值·组六';
                }
            } else if (data.data[0].type == '04') {
                var c_type = '排五';
            }
            $('.c_type').text(c_type);
            jQuery('.dlt_qi').text(data.data[0].order_qi);
            jQuery('.dlt_phone').text(data.data[0].user_mobile);
            var a = data.data[0].order_z;
            var b = data.data[0].order_money;
            var c = data.data[0].order_b;
            window.localStorage.setItem('uid', data.data[0].uid);
            jQuery('.dlt_z').text(a);
            jQuery('.dlt_b').text(c);
            jQuery('.dlt_m').text(b);
            if (data.data[0].order_type == 1) {
                jQuery('.dlt_cp').text('自行取票');
            } else if (data.data[0].order_type == 2) {
                jQuery('.dlt_cp').text('代管代兑');
            } else if (data.data[0].order_type == 3) {
                jQuery('.dlt_cp').text('快递');
            }
            jQuery('.dlt_num').text(data.data[0].order_num);
            if (data.data[0].add == 1) {
                jQuery('.zj').text('追加');
            }
            jQuery('.dlt_time').text(data.data[0].times);
        },
        error: function(xhr, type, errorThrown) {
            //异常处理；
            //console.log(type);
            switch (type) {
                case "timeout":
                    mui.toast('连接超时，请重试');
                    break;
                default:
                    mui.toast('请重试或重新登录');
            }
        }
    });

    mui.ajax(config[0].url+'/index.php/cp_detail_num', {
        data: {
            order_id: order_id,
        },
        dataType: 'json', //服务器返回json格式数据
        type: 'post', //HTTP请求类型
        timeout: 10000, //超时时间设置为10秒；
        success: function(data) {
            if (typeof data == "string") {
                var data = eval('(' + data + ')');
            }

            if (data.data[0].type == '01') {
                var arr = [];
                var brr = [];

                for (var i = 0; i < data.data.length; i++) {
                    var a = '';
                    var b = '';
                    var c = '';

                    brr[i] = data.data[i].numbers.split('|');
                    /*drr=brr[i][0];*/
                    if (brr[i][0].indexOf(';') == -1 && brr[i][1].indexOf(';') == -1) {
                        var crr = [];
                        var drr = [];
                        /*console.log(brr[i][0]);*/
                        crr = brr[i][0].split(',');
                        drr = brr[i][1].split(',');

                        var a = '';
                        var b = '';
                        var c = '';


                        for (var j = 1; j <= crr.length; j++) {
                            a += "<div class='choose_rball rxq'>" + crr[j - 1] + "<input class='choose_h1' type='hidden' value=" + crr[j - 1] + "></div>";
                        }

                        for (var h = 1; h <= drr.length; h++) {
                            b += "<div class='choose_bball bxq'>" + drr[h - 1] + "<input class='choose_h2' type='hidden' value=" + drr[h - 1] + "></div>";
                        }

                        c = "<div class='cp_num'>" + a + b + "<div class='clear'></div></div>";
                        jQuery('.cp_numm').append(c);

                    }

                    if (brr[i][0].indexOf(';') > -1 && brr[i][1].indexOf(';') == -1) {
                        var crr = [];
                        var drr = [];
                        var err = [];
                        var grr = [];
                        /*console.log(brr[i]);
                         console.log(brr[i][0]);*/
                        crr = brr[i][0].split(';');
                        /*console.log(crr);*/
                        grr = crr.pop().split(',');
                        /*console.log(grr);*/
                        //err=crr.split(';');
                        /*console.log(crr);*/
                        drr = brr[i][1].split(',');


                        var b = '';
                        var a = '';
                        var c = '';
                        var d = '';
                        var e = '';
                        var f = '';
                        var g = '';
                        for (var j = 0; j < crr.length; j++) {
                            a += "<div class='choose_rball rxd rd'>" + crr[j] + "<input class='choose_h1' type='hidden' value=" + crr[j] + "></div>";
                        }
                        a = "<div style='float:left'>[胆:</div>" + a + "<div style='float:left'>]</div>";

                        for (var h = 0; h < grr.length; h++) {
                            b += "<div class='choose_rball rxq'>" + grr[h] + "<input class='choose_h1' type='hidden' value=" + grr[h] + "></div>";
                        }

                        for (var k = 0; k < drr.length; k++) {
                            d += "<div class='choose_bball bxq'>" + drr[k] + "<input class='choose_h2' type='hidden' value=" + drr[k] + "></div>";
                        }

                        c = "<div class='cp_num'>" + a + b + d + "<div class='clear'></div></div>";
                        jQuery('.cp_numm').append(c);

                    }


                    if (brr[i][0].indexOf(';') == -1 && brr[i][1].indexOf(';') > -1) {
                        var crr = [];
                        var drr = [];
                        var grr = [];
                        /*console.log(brr[i][0]);*/
                        crr = brr[i][0].split(',');
                        drr = brr[i][1].split(';');
                        grr = drr.pop().split(',');

                        var a = '';
                        var b = '';
                        var c = '';
                        var d = '';


                        for (var j = 0; j < crr.length; j++) {
                            a += "<div class='choose_rball rxq'>" + crr[j] + "<input class='choose_h1' type='hidden' value=" + crr[j] + "></div>";
                        }

                        for (var h = 0; h < drr.length; h++) {
                            b += "<div class='choose_bball bxd bd'>" + drr[h] + "<input class='choose_h2' type='hidden' value=" + drr[h] + "></div>";
                        }
                        b = "<div style='float:left'>[胆:</div>" + b + "<div style='float:left'>]</div>";

                        for (var k = 0; k < grr.length; k++) {
                            d += "<div class='choose_bball bxq'>" + grr[k] + "<input class='choose_h1' type='hidden' value=" + grr[k] + "></div>";

                        }

                        c = "<div class='cp_num'>" + a + b + d + "<div class='clear'></div></div>";
                        jQuery('.cp_numm').append(c);

                    }

                    if (brr[i][0].indexOf(';') > -1 && brr[i][1].indexOf(';') > -1) {
                        var crr = [];
                        var drr = [];
                        var grr = [];
                        var err = [];
                        /*console.log(brr[i][0]);*/
                        crr = brr[i][0].split(';');
                        drr = brr[i][1].split(';');
                        grr = drr.pop().split(',');
                        err = crr.pop().split(',');

                        var a = '';
                        var b = '';
                        var c = '';
                        var d = '';
                        var e = '';

                        for (var p = 0; p < crr.length; p++) {
                            e += "<div class='choose_rball rxd rd'>" + crr[p] + "<input class='choose_h1' type='hidden' value=" + crr[p] + "></div>";
                        }
                        e = "<div style='float:left'>[胆:</div>" + e + "<div style='float:left'>]</div>";


                        for (var j = 0; j < err.length; j++) {
                            a += "<div class='choose_rball rxq'>" + err[j] + "<input class='choose_h1' type='hidden' value=" + err[j] + "></div>";
                        }

                        for (var h = 0; h < drr.length; h++) {
                            b += "<div class='choose_bball bxd bd'>" + drr[h] + "<input class='choose_h2' type='hidden' value=" + drr[h] + "></div>";
                        }
                        b = "<div style='float:left'>[胆:</div>" + b + "<div style='float:left'>]</div>";

                        for (var k = 0; k < grr.length; k++) {
                            d += "<div class='choose_bball bxq'>" + grr[k] + "<input class='choose_h1' type='hidden' value=" + grr[k] + "></div>";

                        }

                        c = "<div class='cp_num'>" + e + a + b + d + "<div class='clear'></div></div>";
                        jQuery('.cp_numm').append(c);
                    }

                }
            } else if (data.data[0].type == '03') {
                if (data.data[0].tz_type == 0) {
                    var a = '';
                    var b = '';
                    var c = '';
                    var d = '';
                    var e = '';
                    var f = "<div style='float: left;width: 9px;height: 21px;text-align: center;color: gray;margin-left: 5px;'>|</div>";
                    var arr = [];
                    for (var i = 0; i < data.data.length; i++) {
                        arr[i] = data.data[i].numbers.split('|');
                        console.log(arr);
                        if (arr[i][0].indexOf(',') > -1) {
                            var brr = [];
                            brr = arr[i][0].split(',');

                            for (var j = 1; j <= brr.length; j++) {
                                a += "<div class='choose_rball rxq'>" + brr[j - 1] + "<input class='choose_h1' type='hidden' value=" + brr[j - 1] + "></div>";
                            }
                        } else if (arr[i][0].indexOf(',') == -1) {
                            a = "<div class='choose_rball rxq'>" + arr[i][0] + "<input class='choose_h1' type='hidden' value=" + arr[i][0] + "></div>";

                        }

                        if (arr[i][1].indexOf(',') > -1) {
                            var crr = [];
                            crr = arr[i][1].split(',');

                            for (var k = 1; k <= crr.length; k++) {
                                b += "<div class='choose_rball rxq'>" + crr[k - 1] + "<input class='choose_h1' type='hidden' value=" + crr[k - 1] + "></div>";
                            }
                        } else if (arr[i][1].indexOf(',') == -1) {
                            b = "<div class='choose_rball rxq'>" + arr[i][1] + "<input class='choose_h1' type='hidden' value=" + arr[i][1] + "></div>";

                        }

                        if (arr[i][2].indexOf(',') > -1) {
                            var drr = [];
                            drr = arr[i][2].split(',');

                            for (var h = 1; h <= drr.length; h++) {
                                c += "<div class='choose_rball rxq'>" + drr[h - 1] + "<input class='choose_h1' type='hidden' value=" + drr[h - 1] + "></div>";
                            }
                        } else if (arr[i][2].indexOf(',') == -1) {
                            c = "<div class='choose_rball rxq'>" + arr[i][2] + "<input class='choose_h1' type='hidden' value=" + arr[i][2] + "></div>";

                        }

                        e = "<div class='cp_num'>" + a + f + b + f + c + "<div class='clear'></div></div>";
                        jQuery('.cp_numm').append(e);


                    }
                } else if (data.data[0].tz_type == 1 || data.data[0].tz_type == 2 || data.data[0].tz_type == 3) {

                    for (var i = 0; i < data.data.length; i++) {
                        var a = '';
                        var b = '';
                        var c = '';
                        var d = '';
                        var e = '';
                        if (data.data[i].numbers.indexOf(';') == -1) {
                            var brr = [];
                            brr = data.data[i].numbers.split(',');
                            console.log(brr);
                            for (var j = 1; j <= brr.length; j++) {
                                a += "<div class='choose_rball rxq'>" + brr[j - 1] + "<input class='choose_h1' type='hidden' value=" + brr[j - 1] + "></div>";
                            }
                            e = "<div class='cp_num'>" + a + "<div class='clear'></div></div>";
                            jQuery('.cp_numm').append(e);
                        }

                        if (data.data[i].numbers.indexOf(';') > -1) {
                            var drr = [];
                            var crr = [];
                            var grr = [];
                            crr = data.data[i].numbers.split(';');
                            console.log(crr);
                            grr = crr.pop().split(',');
                            console.log(grr);
                            console.log(crr);

                            for (var p = 0; p < crr.length; p++) {
                                a += "<div class='choose_rball rxd rd'>" + crr[p] + "<input class='choose_h1' type='hidden' value=" + crr[p] + "></div>";
                            }
                            a = "<div style='float:left'>[胆:</div>" + a + "<div style='float:left'>]</div>";

                            for (var h = 0; h < grr.length; h++) {
                                b += "<div class='choose_rball rxq'>" + grr[h] + "<input class='choose_h1' type='hidden' value=" + grr[h] + "></div>";
                            }

                            e = "<div class='cp_num'>" + a + b + "<div class='clear'></div></div>";
                            jQuery('.cp_numm').append(e);


                        }

                    }
                } else if (data.data[0].tz_type == 4 || data.data[0].tz_type == 5 || data.data[0].tz_type == 6) {
                    var a = '';
                    var b = '';
                    var c = '';
                    var d = '';
                    var e = '';
                    var f = "<div style='float: left;width: 9px;height: 21px;text-align: center;color: gray;margin-left: 5px;'>|</div>";

                    for (var i = 0; i < data.data.length; i++) {
                        var a = '';
                        var arr = [];
                        arr = data.data[i].numbers.split(',');
                        for (var zz = 0; zz < arr.length; zz++) {
                            a += "<div class='choose_rball rxq'>" + arr[zz] + "<input class='choose_h1' type='hidden' value=" + arr[zz] + "></div>";


                        }

                        e = "<div class='cp_num'>" + a + "<div class='clear'></div></div>";
                        jQuery('.cp_numm').append(e);

                    }
                    console.log(arr.length);

                }

            } else if (data.data[0].type == '04') {
                var a = '';
                var b = '';
                var c = '';
                var d = '';
                var e = '';
                var g = '';
                var f = "<div style='float: left;width: 9px;height: 21px;text-align: center;color: gray;margin-left: 5px;'>|</div>";
                var arr = [];
                for (var i = 0; i < data.data.length; i++) {
                    arr[i] = data.data[i].numbers.split('|');
                    console.log(arr);
                    if (arr[i][0].indexOf(',') > -1) {
                        var brr = [];
                        brr = arr[i][0].split(',');

                        for (var j = 1; j <= brr.length; j++) {
                            a += "<div class='choose_rball rxq'>" + brr[j - 1] + "<input class='choose_h1' type='hidden' value=" + brr[j - 1] + "></div>";
                        }
                    } else if (arr[i][0].indexOf(',') == -1) {
                        a = "<div class='choose_rball rxq'>" + arr[i][0] + "<input class='choose_h1' type='hidden' value=" + arr[i][0] + "></div>";

                    }

                    if (arr[i][1].indexOf(',') > -1) {
                        var crr = [];
                        crr = arr[i][1].split(',');

                        for (var k = 1; k <= crr.length; k++) {
                            b += "<div class='choose_rball rxq'>" + crr[k - 1] + "<input class='choose_h1' type='hidden' value=" + crr[k - 1] + "></div>";
                        }
                    } else if (arr[i][1].indexOf(',') == -1) {
                        b = "<div class='choose_rball rxq'>" + arr[i][1] + "<input class='choose_h1' type='hidden' value=" + arr[i][1] + "></div>";

                    }

                    if (arr[i][2].indexOf(',') > -1) {
                        var drr = [];
                        drr = arr[i][2].split(',');

                        for (var h = 1; h <= drr.length; h++) {
                            c += "<div class='choose_rball rxq'>" + drr[h - 1] + "<input class='choose_h1' type='hidden' value=" + drr[h - 1] + "></div>";
                        }
                    } else if (arr[i][2].indexOf(',') == -1) {
                        c = "<div class='choose_rball rxq'>" + arr[i][2] + "<input class='choose_h1' type='hidden' value=" + arr[i][2] + "></div>";

                    }

                    if (arr[i][3].indexOf(',') > -1) {
                        var err = [];
                        err = arr[i][3].split(',');

                        for (var x = 1; x <= err.length; x++) {
                            d += "<div class='choose_rball rxq'>" + err[x - 1] + "<input class='choose_h1' type='hidden' value=" + err[x - 1] + "></div>";
                        }
                    } else if (arr[i][3].indexOf(',') == -1) {
                        d = "<div class='choose_rball rxq'>" + arr[i][3] + "<input class='choose_h1' type='hidden' value=" + arr[i][3] + "></div>";

                    }

                    if (arr[i][4].indexOf(',') > -1) {
                        var grr = [];
                        grr = arr[i][4].split(',');

                        for (var z = 1; z <= grr.length; z++) {
                            g += "<div class='choose_rball rxq'>" + grr[z - 1] + "<input class='choose_h1' type='hidden' value=" + grr[z - 1] + "></div>";
                        }
                    } else if (arr[i][4].indexOf(',') == -1) {
                        g = "<div class='choose_rball rxq'>" + arr[i][4] + "<input class='choose_h1' type='hidden' value=" + arr[i][4] + "></div>";

                    }

                    e = "<div class='cp_num'>" + a + f + b + f + c + f + d + f + g + "<div class='clear'></div></div>";
                    jQuery('.cp_numm').append(e);
                }
            } else if (data.data[0].type == '02') {

                var a = '';
                var b = '';
                var c = '';
                var d = '';
                var e = '';
                var g = '';
                var m = '';
                var n = '';
                var f = "<div style='float: left;width: 9px;height: 21px;text-align: center;color: gray;margin-left: 5px;'>|</div>";
                var arr = [];
                for (var i = 0; i < data.data.length; i++) {
                    arr[i] = data.data[i].numbers.split('|');
                    console.log(arr);
                    if (arr[i][0].indexOf(',') > -1) {
                        var brr = [];
                        brr = arr[i][0].split(',');

                        for (var j = 1; j <= brr.length; j++) {
                            a += "<div class='choose_rball rxq'>" + brr[j - 1] + "<input class='choose_h1' type='hidden' value=" + brr[j - 1] + "></div>";
                        }
                    } else if (arr[i][0].indexOf(',') == -1) {
                        a = "<div class='choose_rball rxq'>" + arr[i][0] + "<input class='choose_h1' type='hidden' value=" + arr[0] + "></div>";

                    }

                    if (arr[i][1].indexOf(',') > -1) {
                        var crr = [];
                        crr = arr[i][1].split(',');

                        for (var k = 1; k <= crr.length; k++) {
                            b += "<div class='choose_rball rxq'>" + crr[k - 1] + "<input class='choose_h1' type='hidden' value=" + crr[k - 1] + "></div>";
                        }
                    } else if (arr[i][1].indexOf(',') == -1) {
                        b = "<div class='choose_rball rxq'>" + arr[i][1] + "<input class='choose_h1' type='hidden' value=" + arr[1] + "></div>";

                    }

                    if (arr[i][2].indexOf(',') > -1) {
                        var drr = [];
                        drr = arr[i][2].split(',');

                        for (var h = 1; h <= drr.length; h++) {
                            c += "<div class='choose_rball rxq'>" + drr[h - 1] + "<input class='choose_h1' type='hidden' value=" + drr[h - 1] + "></div>";
                        }
                    } else if (arr[i][2].indexOf(',') == -1) {
                        c = "<div class='choose_rball rxq'>" + arr[i][2] + "<input class='choose_h1' type='hidden' value=" + arr[2] + "></div>";

                    }

                    if (arr[i][3].indexOf(',') > -1) {
                        var err = [];
                        err = arr[i][3].split(',');

                        for (var p = 1; p <= err.length; p++) {
                            g += "<div class='choose_rball rxq'>" + err[p - 1] + "<input class='choose_h1' type='hidden' value=" + err[p - 1] + "></div>";
                        }
                    } else if (arr[i][3].indexOf(',') == -1) {
                        g = "<div class='choose_rball rxq'>" + arr[i][3] + "<input class='choose_h1' type='hidden' value=" + arr[3] + "></div>";

                    }

                    if (arr[i][4].indexOf(',') > -1) {
                        var grr = [];
                        grr = arr[i][4].split(',');

                        for (var u = 1; u <= grr.length; u++) {
                            m += "<div class='choose_rball rxq'>" + grr[u - 1] + "<input class='choose_h1' type='hidden' value=" + grr[u - 1] + "></div>";
                        }
                    } else if (arr[i][4].indexOf(',') == -1) {
                        m = "<div class='choose_rball rxq'>" + arr[i][4] + "<input class='choose_h1' type='hidden' value=" + arr[4] + "></div>";

                    }

                    if (arr[i][5].indexOf(',') > -1) {
                        var hrr = [];
                        hrr = arr[i][5].split(',');

                        for (var x = 1; x <= hrr.length; x++) {
                            d += "<div class='choose_rball rxq'>" + hrr[x - 1] + "<input class='choose_h1' type='hidden' value=" + hrr[x - 1] + "></div>";
                        }
                    } else if (arr[i][5].indexOf(',') == -1) {
                        d = "<div class='choose_rball rxq'>" + arr[i][5] + "<input class='choose_h1' type='hidden' value=" + arr[5] + "></div>";

                    }

                    if (arr[i][6].indexOf(',') > -1) {
                        var trr = [];
                        trr = arr[i][6].split(',');

                        for (var z = 1; z <= trr.length; z++) {
                            n += "<div class='choose_rball rxq'>" + trr[z - 1] + "<input class='choose_h1' type='hidden' value=" + trr[z - 1] + "></div>";
                        }
                    } else if (arr[i][6].indexOf(',') == -1) {
                        n = "<div class='choose_rball rxq'>" + arr[i][6] + "<input class='choose_h1' type='hidden' value=" + arr[6] + "></div>";

                    }

                    e = "<div class='cp_num'>" + a + f + b + f + c + f + g + f + m + f + d + f + n + "<div class='clear'></div></div>";
                    jQuery('.cp_numm').append(e);


                }
            }
        },
        error: function(xhr, type, errorThrown) {
            //异常处理；
            //console.log(type);
            switch (type) {
                case "timeout":
                    mui.toast('连接超时，请重试');
                    break;
                default:
                    mui.toast('请重试或重新登录');
            }
        }
    });


    jQuery(document).on('tap', '.cp_up', function() {
        $('.cp_up').attr('disabled', true);
        var pic = $('#pics').html();
        /*if(pic=='' || pic==null || pic==undefined){
         mui.toast('上传照片后才能出票');return;
         }*/
        var uid = window.localStorage.getItem('uid');
        //alert(uid);
        window.localStorage.setItem('cp_sta', 0);
        window.localStorage.setItem('cp_ss', 1);
        mui.ajax(config[0].url+'/index.php/send', {
            data: {
                muban_id: 2,
                id: uid,
                openid: 0,
                order_id: order_id,
            },
            dataType: 'json', //服务器返回json格式数据
            type: 'post', //HTTP请求类型
            timeout: 10000, //超时时间设置为10秒；
            success: function(data) {
                if (typeof data == "string") {
                    var data = eval('(' + data + ')');
                }
            },
            error: function(xhr, type, errorThrown) {
                //异常处理；
                //console.log(type);
                switch (type) {
                    case "timeout":
                        mui.toast('连接超时，请重试');
                        break;
                    default:
                        mui.toast('请重试或重新登录');
                }
            }
        });


        mui.ajax(config[0].url+'/index.php/orderlog', {
            data: {
                order_id: order_id,
                order_status: '03',
                value: '请在30分钟内确认出票是否正确',
            },
            dataType: 'json', //服务器返回json格式数据
            type: 'post', //HTTP请求类型
            timeout: 10000, //超时时间设置为10秒；
            success: function(data) {
                if (typeof data == "string") {
                    var data = eval('(' + data + ')');

                }

            },
            error: function(xhr, type, errorThrown) {
                //异常处理；
                //console.log(type);
                switch (type) {
                    case "timeout":
                        mui.toast('连接超时，请重试');
                        break;
                    default:
                        mui.toast('请重试或重新登录');
                }
            }
        });
        var d_money = jQuery('.dlt_m').text();
        mui.ajax(config[0].url+'/index.php/cp_status', {
            data: {
                order_id: order_id,
                status: '03',
                read_status: 2,
                d_money: d_money,
                biaoshi: 1,
            },
            dataType: 'json', //服务器返回json格式数据
            type: 'post', //HTTP请求类型
            timeout: 10000, //超时时间设置为10秒；
            success: function(data) {
                mui.openWindow({
                    url: 'order_detail.html',
                    id: 'order_detail',
                    createNew: true
                });
            },
            error: function(xhr, type, errorThrown) {
                //异常处理；
                //console.log(type);
                switch (type) {
                    case "timeout":
                        mui.toast('连接超时，请重试');
                        break;
                    default:
                        mui.toast('请重试或重新登录');
                }
            }
        });
    })
</script>

</html>
